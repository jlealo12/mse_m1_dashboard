---
title: "Reporte Carrela La Luz 2022"
output: 
  flexdashboard::flex_dashboard:
    theme:
      bg: "#141b41"
      fg: "#ffffff" 
      primary: "#6f9ceb"
      base_font:
        google: Prompt
      code_font:
        google: JetBrains Mono
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(fontawesome)
# Install thematic and un-comment for themed static plots (i.e., ggplot2)
thematic::thematic_rmd()
library(paqueteMET)   # activar paqueteMET
library(dplyr)
library(tidyverse)

data("CarreraLuz22")  # cargar la data

data = CarreraLuz22

rNms <- c("Bogota",
          "Bogotá",               
          "Bogota D.c",
          "Cali",
          "Cali Valle",
          "Florida",
          "Florida Va",
          "Jamundi",
          "Jamundí",
          "Popayan",
          "Popayán",
          "Tulua",
          "Tuluá")
pNms <- c("Bogotá",
          "Bogotá",               
          "Bogotá",
          "Cali",
          "Cali",
          "Florida",
          "Florida",
          "Jamundí",
          "Jamundí",
          "Popayán",
          "Popayán",
          "Tuluá",
          "Tuluá")
pData <- data


for (i in 1:length(rNms)) {
  pData["origen"][pData["origen"]==rNms[i]] <- pNms[i]
}

for (i in unique(pData$origen)) {
  nCat <- length(pData["origen"][pData["origen"]==i])
  if (nCat<5) {pData["origen"][pData["origen"]==i]<-"Otros"}
}
pData["time.min"] = pData["timerun"]/60
pData["time.H"] = pData["timerun"]/(60*60)
pData["vel.kmh"] = 10/pData["time.H"]
pData["nacionalidad"][pData["nacionalidad"]==0] <- "No Registra"
```


Sidebar {.sidebar}
=======================================================================
### Descripción reporte

El presente reporte muestra un análisis descriptivo aplicado a los resultados de la carrera La Luz. La edición 17 de este evento, desarrollada el 23 de Octubre de 2022 en la ciudad de Cali, contó con modalidades de 5K y 10K [1].

Para el presente análisis, se obtuvieron datos sobre los resultados de la modalidad 10K, en particular de las siguientes variables:

1. Sexo del participante
2. Edad
3. Origen: ciudad procedencia
4. Tiempo de carrera
5. Categoría corredor
6. Nacionalidad

En adición a estas variables, se calculó la velocidad de los participantes para ser incluída en el reporte.

[1] Web: https://juanchocorrelon.com/intercontinental-10k-luz-2022/

Resúmen variables {data-orientation=rows}
================================================
## Row 
### Número de participantes

```{r}
valueBox(
    value = length(data$id),
    icon = "fa-users",
  )
```
### Distancia total

```{r}
valueBox(
    value = "10 km",
    icon = "fa-road",
  )
```
### Velocidad promedio

```{r}
valueBox(
    value = sprintf("%.2f km/h",mean(pData$vel.kmh)),
    icon = "fa-bolt",
  )
```
### Tiempo promedio carrera

```{r}
valueBox(
    value = sprintf("%.2f min",mean(pData$timerun/60)),
    icon = "fa-clock",
  )
```

## Row {data-height="50"}
**Resumen distribución de variables dataset**

## Row {.tabset .tabset-fade data-height="500"}
### Desempeño promedio
```{r}
vsmTbl <- pData %>% 
  group_by(categoria,sex) %>%
  summarise_at(vars(edad,time.min), funs(mean, sd))

knitr::kable(vsmTbl,digits = 2,col.names = c("Categoría","Sexo","Edad promedio (años)","Tiempo promedio (min)","SD edad (años)","SD tiempo (min)"))
```
> Aunque los tiempos de carrera de las mujeres son mayores, sus desviaciones son menores en varias categorías, indicando mayor consistencia en sus desempeños.


### Categorías
```{r}
cTbl = summarytools::freq(data$categoria, cumul = T,report.nas = FALSE,round.digits = 2)
knitr::kable(summarytools::tb(cTbl,na.rm=T),digits = 2,col.names = c("Categoría","Conteo","% Total","% Acumulado"))
```
### Sexos
```{r}
sTbl = summarytools::freq(data$sex, cumul = T,report.nas = FALSE,round.digits = 2)
knitr::kable(summarytools::tb(sTbl,na.rm=T),digits = 2,col.names = c("Sexo","Conteo","% Total","% Acumulado"))
```
### Categorías por sexo
```{r}
dSC <- table(data$categoria,data$sex) %>% prop.table()*100
knitr::kable(dSC,digits = 2)
```
### Nacionalidades
```{r}
nTbl = summarytools::freq(pData$nacionalidad, cumul = T,order="-freq")
knitr::kable(summarytools::tb(nTbl,na.rm=T),digits = 2,col.names = c("Nacionalidad","Conteo","% Total","% Acumulado"))
```
### Edades
```{r}
tTbl = summarytools::descr(pData$edad)
knitr::kable(summarytools::tb(tTbl,na.rm=T),digits = 2,)
```
> Las edades se reportan en años.

### Tiempos de carrera
```{r}
tTbl = summarytools::descr(pData$time.min)
knitr::kable(summarytools::tb(tTbl,na.rm=T),digits = 2,)
```
> Los tiempos se presentan en minutos.

### Velocidades promedio
```{r}
vTbl = summarytools::descr(pData$vel.kmh)
knitr::kable(summarytools::tb(vTbl,na.rm=T),digits = 2,)
```
> Las velocidades se muestran en km/h.


## Row
### Participación mujeres

```{r}
nMuj <- length(data["sex"][data["sex"]=="Mujer"])
nTot <- length(pData$sex)
pMuj <- nMuj*100/nTot
valueBox(
    value = sprintf("%.0f",pMuj),
    icon = "fa-percent",
  )
```
### Edad promedio participantes

```{r}
valueBox(
    value = sprintf("%.0f años",mean(pData$edad)),
    icon = "fa-hourglass-half",
  )
```
### Número de categorías

```{r}
valueBox(
    value = length(unique(data$categoria)),
    icon = "fa-signal",
  )
```
### Número de nacionalidades

```{r}
valueBox(
    value = length(unique(data$nacionalidad)),
    icon = "fa-globe",
  )
```


Análisis distribucional
================================================
Row {.tabset .tabset-fade}
-----------------------------------------------
### Tiempos de carrera
```{r}
ggplot(pData, aes(time.min)) +
  geom_histogram(aes(y=..density..))+
  xlab("Tiempo (min)") + ylab("")+
  ggtitle("Distribución total de tiempos de carrera")
```


### Tiempos detallados

```{r}
ggplot(pData, aes(time.min)) +
  geom_histogram(aes(y=..density..))+
  facet_grid(vars(sex),vars(categoria))+
  xlab("Tiempo (min)") + ylab("")+
  ggtitle("Distribución detallada de tiempos por categoría y sexo")
```

> Aquí iría una descripción de esto

### Velocidad 

```{r}
ggplot(pData, aes(vel.kmh)) +
  geom_histogram(aes(y=..density..))+
  xlab("Velocidad (km/h)") + ylab("")+
  ggtitle("Distribución total de velocidades")
```

### Velocidad detallada

```{r}
ggplot(pData, aes(vel.kmh)) +
  geom_histogram(aes(y=..density..))+
  facet_grid(vars(sex),vars(categoria))+
  xlab("Velocidad (km/h)") + ylab("")+
  ggtitle("Distribución detallada de velocidad por categoría y sexo")
```

> Aquí iría una descripción de esto

### Edades 

```{r}
ggplot(pData, aes(edad)) +
  geom_histogram(aes(y=..density..))+
  xlab("Edad (años)") + ylab("")+
  ggtitle("Distribución edades corredores")
```


Análisis de correlación
================================================
Row {.tabset .tabset-fade}
-----------------------------------------------
### Tiempos vs edad

```{r}
fData=subset(pData, pData$time.min<=120) 
ggplot(fData, aes(edad,time.min)) +
  geom_point()+
  stat_smooth(method = "loess" , formula =y ~ x)+
  coord_cartesian(xlim = c(15, 80), ylim = c(35,120))+
  xlab("Edad Años") + ylab("Tiempo (min)")+
  ggtitle("Correlación detallada de tiempos con edad, por categoría y sexo")
```

> Aquí iría una descripción de esto

### Tiempos vs sexo

```{r}
fData=subset(pData, pData$time.min<=120) 
ggplot(fData, aes(sex,time.min)) +
  geom_boxplot()+
  coord_cartesian(ylim = c(35,120))+
  xlab("Sexo") + ylab("Tiempo (min)")+
  ggtitle("Correlación de tiempos con sexo")
```

> Aquí iría una descripción de esto

### Tiempos vs sexo detallado

```{r}
fData=subset(pData, pData$time.min<=120) 
ggplot(fData, aes(sex,time.min)) +
  geom_boxplot()+
  coord_cartesian(ylim = c(35,120))+
  facet_grid(cols=vars(categoria))+
  xlab("Sexo") + ylab("Tiempo (min)")+
  ggtitle("Correlación detallada de tiempos con sexo")
```

> Aquí iría una descripción de esto

### Tiempos detallados

```{r}
fData=subset(pData, pData$time.min<=120) 
ggplot(fData, aes(edad,time.min)) +
  geom_point()+
  coord_cartesian(ylim = c(35,120))+
  facet_grid(vars(sex),vars(categoria),scales="free_x")+
  xlab("Edad Años") + ylab("Tiempo (min)")+
  ggtitle("Correlación detallada de tiempos con edad, por categoría y sexo")
```

> Aquí iría una descripción de esto